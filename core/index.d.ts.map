{"mappings":"AAGA,OAAO,MAAM,8BAAoB,CAAC;AAClC,OAAO,MAAM,yDAAwD,CAAA;AAGrE,OAAO,MAAM,oCAA0B,CAAC;AAIxC,OAAO,MAAM,kCAAwB,CAAC;AACtC,OAAO,MAAM,6DAA4D,CAAA;AAGzE,OAAO,MAAM,aAAkB,CAAC;AAChC,OAAO,MAAM,uBAAsD,CAAA;ACdnE,OAAO,IAAI,QAAQ,OAAO,CAAC,KAAK,EAAE,KAAK,CAAiB,CAAC;AACzD,0BAA0B,CAAC,SAAS,WAAW,EAAE,EAAE,EAAE,CAAC,EAAE,WAAW,EAAE,CAAC,OAAO,EAAE,eAAe,EAAE,IAAI,EAAE,MAAM,KAAK,YAAY,CAAC,KAAK,CAAC,QAkCnI;ACnCD,OAAO,MAAM,WAAc,CAAC;AAC5B,OAAO,MAAM,UAAU,OAAO,OAAwB,CAAC;AACvD,OAAO,MAAM,aAAa,OAAO,CAAC,GAAG,EAAE,GAAG,CAAiB,CAAC;AAC5D,yBAAyB,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,GAAG,CAAC,OAAA,KAAK,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,EAAE,GAAG,CAAC,OAAA,KAAK,CAAC,CAEhF;AACD,0BAA0B,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,EAAE,GAAG,CAAC,OAAA,KAAK,CAAC,CAAC;AAC1D,0BAA0B,CAAC,IAAI;KAAG,IAAI,IAAI,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,SAAS,cAAc,MAAM,EAAE,EAAE,MAAM,CAAC,EAAE,MAAM,CAAC,CAAC,GAAG,CAAC,IAAI,EAAE,EAAE,EAAE,GAAG,CAAC,OAAA,KAAK,CAAC,GAAG,KAAK;CAAE,CAAC;AAChJ,8BAA8B,CAAC,SAAS,MAAM,EAAE,GAAG,EAAE,CAAC,GAAG,cAAc,CAAC,CAAC,CAOxE;AAED,qBAAqB,CAAC,SAAS;KAAG,CAAC,IAAI,CAAC,GAAG,MAAM;CAAE,EAAE,CAAC,SAAS,MAAM,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,OAAO,EAAE,eAAe,KAAK,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,UAAkB,EAAE,KAAc,EAAE,GAAE;IAAE,UAAU,CAAC,EAAE,OAAO,CAAC;IAAC,KAAK,CAAC,EAAE,aAAa,CAAA;CAAO,QA+BpO;AACD,yBAAyB,CAAC,SAAS;KAAG,CAAC,IAAI,CAAC,GAAG,GAAG;CAAE,EAAE,CAAC,SAAS,MAAM,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,uBAAuB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,SAAS,KAAK,uBAAuB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,QAKtK","sources":["core/core/extras.ts","core/core/events.ts","core/core/index.ts","core/index.ts"],"sourcesContent":[null,null,null,"import { _WeakMap_prototype } from './extras.ts';\n\nexport const _Proxy = Proxy;\nexport const _Reflect: typeof Reflect = { ...Reflect };\nexport const hookProxies: WeakMap<any, any> = new WeakMap();\nexport function snapshot<T, U, V>(fn: (this: T, ...U) => V): (self: T, ...U) => V {\n    return fn.call.bind(fn);\n}\nexport type SnapshotInput<T, U, V> = (this: T, ...U) => V;\nexport type ProtoSnapshot<T> = { [Prop in keyof T]: T[Prop] extends SnapshotInput<infer T2, infer U, infer V> ? (self: T2, ...U) => V : never };\nexport function snapshotProto<T extends object>(val: T): ProtoSnapshot<T> {\n    let a = {};\n    for (let k of Object.keys(val)) {\n        let wrapped;\n        if ((wrapped = val[k]) instanceof Function) a[k] = snapshot(wrapped);\n    }\n    return a as ProtoSnapshot<T>;\n}\n\nexport function hook<T extends { [a in K]: object }, K extends keyof T>(a: T, b: K, c: (Reflect: typeof _Reflect) => ProxyHandler<T[K]>, { isProperty = false, Proxy = _Proxy }: { isProperty?: boolean, Proxy?: typeof _Proxy } = {}) {\n    // a[b] = new _Proxy(a[b], c(_Reflect));\n    if (isProperty) {\n        hookProp(a, b, d => ((d ??= { value: undefined }), {\n            configurable: d?.configurable ?? true,\n            enumerable: d?.enumerable ?? true,\n            writable: d?.writable ?? true,\n            get() {\n                var p: T[K], v: T[K];\n                if (d?.get) {\n                    p = new (Proxy)(v = d!.get!(), c(_Reflect));\n                } else {\n                    p = new (Proxy)(v = d!.value!, c(_Reflect));\n                }\n                _WeakMap_prototype.set(hookProxies, p, v);\n                return p;\n            },\n            set(value) {\n                while (_WeakMap_prototype.has(hookProxies, value)) {\n                    value = _WeakMap_prototype.get(hookProxies, value)!;\n                }\n                if (d?.set) {\n                    d!.set!(value)\n                } else {\n                    d.value = value;\n                }\n            }\n        }));\n    } else {\n        a[b] = new (Proxy)(a[b],c(_Reflect));\n    }\n}\nexport function hookProp<T extends { [a in K]: any }, K extends keyof T>(a: T, b: K, c: (d: TypedPropertyDescriptor<T[K]> | undefined) => TypedPropertyDescriptor<T[K]>) {\n    let d = _Reflect.getOwnPropertyDescriptor(a, b);\n    // if (d !== undefined) {\n    _Reflect.defineProperty(a, b, c(d));\n    // }\n}\nexport * from './events.ts'\nexport * from './extras.ts'"],"names":[],"version":3,"file":"index.d.ts.map"}